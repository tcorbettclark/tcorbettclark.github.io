<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta name="generator" content="HTML Tidy for HTML5 for Apple macOS version 5.8.0" />
    <meta charset="utf-8" />
    <meta http-equiv="Referrer-Policy" content="no-referrer" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="Upgrade-Insecure-Requests" content="1" />
    <meta http-equiv="Strict-Transport-Security" content="max-age=63072000; includeSubDomains" />
    <meta http-equiv="Content-Security-Policy" content=
    "upgrade-insecure-requests; default-src 'none'; require-trusted-types-for 'script'; base-uri 'self'; img-src 'self'; manifest-src 'self'; script-src-elem 'strict-dynamic' 'sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6' 'sha384-yTB2wx6UBfG/vVmw00WOL5kU63/nWDZTw1KXg6BapzYP+xoYMMDemsecEoIJEK5h' 'sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp' 'sha384-nq/jJqKHx2Beq2PLdLsH/0zMwhVN8i9yl8mm8MikpU3k2nTuAJIWXQdIKTyhGQ0w' 'sha384-H2o0JdK+a6Nv0Bq7U4BlXJ36aFpF5pw1X/JWhzWBYGGNZQQVFqBTD9hUrk0IuIIS' 'sha384-Yfa985Z0LorjBya15TjALqmYYUOLsdk67u37ToLE+xJAfmJ8G78yGxNkv4zPJsBI' ; connect-src 'self' https://ka-f.fontawesome.com ; font-src https://cdn.jsdelivr.net https://ka-f.fontawesome.com ; style-src 'self' https://cdn.jsdelivr.net 'sha256-E2q5uhm+T8+yRPO91kGFCPrb999m9YzwEB9sWmKzTwk=' 'sha256-xyO8S5xWOAtczCCfbCiMJgKOLsrQ0neV9mX7Aan06aw=' 'sha256-bi2K0pOjkFvwpWy9QI9qM3EUJiA+VcVJ5GGZIwSEFhQ=' 'sha256-0Y0YoXQ0nmYkphSjq+iyr2TWsiF2CUw7gsn8mpwIUog=' 'sha384-tl5h4XuWmVzPeVWU0x8bx0j/5iMwCBduLEgZ+2lH4Wjda+4+q3mpCww74dgAB3OX' 'sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP' 'sha384-vpayKGwduWhgY00faoPtbmJwz8TjOLnnDuqvy+xWy2DWuIVxIt0dxj0mjrMVPxdd' 'sha384-6tuxMr6N8BYhY1MziAiDxbBp7gb26fGRPr8qQoxo6b6wrAZ15oleECL9OBf2NJjk' ;" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Timothy Corbett-Clark" />
    <meta name="description" content="Personal website of Dr Timothy Corbett-Clark" />
    <title>
      Dr Timothy Corbett-Clark
    </title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"
    integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href=
    "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/base16/gruvbox-light-hard.min.css"
    integrity="sha384-vpayKGwduWhgY00faoPtbmJwz8TjOLnnDuqvy+xWy2DWuIVxIt0dxj0mjrMVPxdd" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css" integrity=
    "sha384-tl5h4XuWmVzPeVWU0x8bx0j/5iMwCBduLEgZ+2lH4Wjda+4+q3mpCww74dgAB3OX" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="/main.css" integrity=
    "sha384-6tuxMr6N8BYhY1MziAiDxbBp7gb26fGRPr8qQoxo6b6wrAZ15oleECL9OBf2NJjk" />
    <script defer="defer" src="https://kit.fontawesome.com/39e34b83e1.js" integrity=
    "sha384-yTB2wx6UBfG/vVmw00WOL5kU63/nWDZTw1KXg6BapzYP+xoYMMDemsecEoIJEK5h" crossorigin="anonymous"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity=
    "sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"
    integrity="sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp" crossorigin=
    "anonymous"></script>
    <script defer="defer" src="/hot-reloader.js" integrity=
    "sha384-nq/jJqKHx2Beq2PLdLsH/0zMwhVN8i9yl8mm8MikpU3k2nTuAJIWXQdIKTyhGQ0w" async="async"></script>
    <script defer="defer" src="/render-maths.js" integrity=
    "sha384-H2o0JdK+a6Nv0Bq7U4BlXJ36aFpF5pw1X/JWhzWBYGGNZQQVFqBTD9hUrk0IuIIS"></script>
    <script defer="defer" src="/render-code.js" integrity=
    "sha384-Yfa985Z0LorjBya15TjALqmYYUOLsdk67u37ToLE+xJAfmJ8G78yGxNkv4zPJsBI"></script>
  </head>
  <body>
    <header class="hero is-small is-primary">
      <div class="hero-body">
        <p class="title">
          Dr Timothy Corbett‑Clark
        </p>
        <p class="subtitle">
          CTO, Researcher, Developer
        </p>
      </div>
    </header>
    <section class="section pb-3 pt-3 has-background-primary-bold-invert has-text-primary-bold">
      <nav class="level">
        <div class="level-left">
          <div class="level-item">
            <span class="tag"><a href="/welcome/index.html"><i class="fa-solid fa-home"></i> Home</a></span>
          </div>
          <div class="level-item">
            <span class="tag"><a href="index.html"><i class="fa-solid fa-arrow-left"></i> Back to: Building this
            website</a></span>
          </div>
        </div>
      </nav>
    </section>
    <section class="section pt-0 has-background-primary-bold-invert has-text-primary-bold">
      <div class="box">
        <div class="title is-size-2 has-text-centered">
          Content approach
        </div>
        <div class="content">
          <p>
            This page explains how I structured all the web files, templates, and data to achieve this website. It also
            contains my notes on hosting, validation, security, selecting libraries, rendering maths and code nicely,
            making the navigation breadcrumb, choosing colours, creating the favicon and app manifest, making the XML
            sitemap, adding a draft/wip mode, …
          </p>
          <p>
            Hence this page provides <em>recipes</em> for how to achieve the various features of a website. They are
            mostly independent of one another, allowing for easy modification, substitution, or ommission (and the
            agnostic nature of <a href="awg.html">AWG</a> means that nothing is left behind).
          </p>
          <h1>
            File structure
          </h1>
          <p>
            Organisational considerations include:
          </p>
          <ol>
            <li>The purpose of each file, the relationship with other files, and especially how nearby each file is to
            related files.
            </li>
            <li>When the file is loaded by the templating mechanism (<code>{% include %}</code> or <code>{% extends
            %}</code>).
            </li>
            <li>When the file is loaded by the browser.
            </li>
            <li>Where browsers expect or need to find special files.
            </li>
          </ol>
          <p>
            This translates into the following principles:
          </p>
          <ol>
            <li>Use a flat root directory for all files which browsers expect to see there, such as
            <code>robots.txt</code>, <code>sitemap.xml</code>, the app manifest, favicons, etc.
            </li>
            <li>Use a flat root directory for all the files loaded by the base template (<code>_base.html</code>) on
            every page. The base template uses absolute paths.
            </li>
            <li>Only extend templates from the same directory or in parent directories. So the template hierarchy
            overlays the file system hierarchy.
            </li>
            <li>Otherwise, keep related files together in their own directory. And use relative paths.
            </li>
          </ol>
          <p>
            Even though it is traditional, I don’t organise files by type (all javascript in <code>/js/</code>, all css
            in <code>/css/</code>, etc).
          </p>
          <p>
            The result is quite a few files in the root directory, but with the benefit that they are all visible. And
            then each page has its own directory, with child pages in child directories, etc.
          </p>
          <p>
            The template inheritance hierarchy is simple:
          </p>
          <ul>
            <li>The base template is in <code>/_base.html</code>, and includes <code>/_header.html</code> and
            <code>/_footer.html</code>.
            </li>
            <li>The page template is in <code>/_page.html</code>, extends the base template, and adds blocks for the
            breadcrumb, title, page content, and the “page is draft” additions (see below).
            </li>
            <li>Most concrete pages then extend the page template (the welcome page being an exception, as it alters
            the layout to have a sidebar card).
            </li>
          </ul>
          <h1>
            Indentation management
          </h1>
          <p>
            All HTML files are indented for clarity during editing. On output after templating, they are all formatted
            properly by <a href="awg.html">AWG</a>, so there is no need to try to generate properly indented HTML
            within the templates (avoiding fiddly whitespace management with “-” in e.g. <code>{%- ... %}</code>). For
            example, the indentation below is entirely to aid readability at the template stage (rather than final
            HTML).
          </p>
          <pre><code class="language-HTML">{% extends "../_page.html" %}

{% block breadcrumb %}
    {{ super() }}
    &lt;div class="level-item"&gt;
        &lt;span class="tag"&gt;
            &lt;a href="index.html"&gt;&lt;i class="fa-solid fa-arrow-left"&gt;&lt;/i&gt; Back to: Building this website&lt;/a&gt;
        &lt;/span&gt;
    &lt;/div&gt;
{% endblock breadcrumb %}

{% block title %} Content approach {% endblock title %}

{% block page %}
    {{ "_approach.md" | markdown() }}
{% endblock page %}
</code></pre>
          <p>
            To make editing easy with language specific editing/formatting/colourising modes, I avoid files containing
            a mixture of languages. Hence there are separate files for each piece of markdown, no “frontmatter”
            TOML/YAML within markdown files, javascript is always included from <code>.js</code> files, etc.
          </p>
          <h1>
            Choice of web framework
          </h1>
          <p>
            There are many to choose from, but I selected <a href="https://bulma.io">Bulma</a> because it is CSS only
            (no javascript), looks good, is well documented, very popular, and actively maintained. I like the
            responsive layout and support for colour management.
          </p>
          <p>
            The two closest alternatives were:
          </p>
          <ul>
            <li>
              <a href="https://getbootstrap.com">Bootstrap</a>, which is older, bit boring looking now, and slightly
              heavier weight than I need.
            </li>
            <li>
              <a href="https://getuikit.com">UIkit</a>, which looks slick, but is perhaps more intended for
              applications. Also there is less support e.g. for colours.
            </li>
          </ul>
          <h1>
            Maths
          </h1>
          <p>
            For any substantial maths I create PDFs using <a href="https://typst.app">Typst</a>, but for immediately
            visible maths in the browser I use the javascript library, <a href="https://katex.org">KaTeX</a>. Other
            libraries exist but Katex is well maintained, popular, and fast.
          </p>
          <p>
            The Common Markdown parser used by <a href="awg.html">AWG</a> includes the <a href=
            "https://mdit-py-plugins.readthedocs.io/en/latest/#mdit_py_plugins.dollarmath.dollarmath_plugin">dollarmath_plugin</a>.
            It produces inline and block maths with the following HTML markup:
          </p>
          <pre><code class="language-HTML">&lt;span class="math inline"&gt; ...latex maths... &lt;/span&gt;
&lt;div class="math block"&gt; ...latex maths... &lt;/div&gt;
</code></pre>
          <p>
            A small amount of javascript makes KaTeX render on the correct elements after the DOM has loaded:
          </p>
          <pre><code class="language-javascript">document.addEventListener("DOMContentLoaded", (event) =&gt; {
  for (var node of document.getElementsByClassName("math")) {
    katex.render(node.innerText, node, {
      displayMode: node.classList.contains("block"), // otherwise assume it is "inline"
      throwOnError: false,
    });
  }
});
</code></pre>
          <p>
            I put this javascript in the file <code>/render-maths.js</code> and load it in the
            <code>&lt;head&gt;</code> tag of the base template. This is also where we load the KaTeX library (both
            javascript and CSS) from the <a href="https://cdn.jsdelivr.net">jsDelivr CDN</a>:
          </p>
          <pre><code class="language-HTML">&lt;head&gt;
    ...
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous"&gt;
    ...
    &lt;script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"&gt;&lt;/script&gt;
    ...
    &lt;script defer src="/render-maths.js"&gt;&lt;/script&gt;
    ...
&lt;/head&gt;
</code></pre>
          <p>
            The result is for markdown such as
          </p>
          <pre><code class=
          "language-text">For example, inline maths looks like $(x+1)^2 - (x-1)^2 = 4x$, and block maths like

$$
\sum_{k=1}^n { k! \over (1+k)^2 }
$$
</code></pre>
          <p>
            to be displayed as
          </p>
          <blockquote>
            <p>
              For example, inline maths looks like <span class="math inline">(x+1)^2 - (x-1)^2 = 4x</span>, and block
              maths like
            </p>
            <div class="math block">
              \sum_{k=1}^n { k! \over (1+k)^2 }
            </div>
          </blockquote>
          <h1>
            Code
          </h1>
          <p>
            Highlighting code is easy with <a href="https://highlightjs.org">highlight.js</a>. This will colour many
            different programming languages in any of a number of different themes, expecting HTML markup like
          </p>
          <pre><code class="language-HTML">&lt;pre&gt;
    &lt;code class="language-python"&gt;
        ...python code...
    &lt;/code&gt;
&lt;/pre&gt;
</code></pre>
          <p>
            The Common Markdown standard used by <a href="awg.html">AWG</a> has <a href=
            "https://spec.commonmark.org/0.31.2/#fenced-code-blocks">fenced code blocks</a> which produces tags with
            CSS classes exactly like this.
          </p>
          <p>
            So we just need to pull in the Javascript and chosen theme CSS (in this case,
            <code>gruvbox-light-hard</code>) from a CDN, and ask it to render once the page has loaded. Hence the
            <code>&lt;head&gt;</code> section of the base template contains:
          </p>
          <pre><code class="language-HTML">&lt;head&gt;
    ...
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/gruvbox-light-hard.min.css"&gt;
    ...
    &lt;script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js" crossorigin="anonymous"&gt;&lt;/script&gt;
    ...
    &lt;script defer src="/render-code.js"&gt;&lt;/script&gt;
    ...
&lt;/head&gt;
</code></pre>
          <p>
            and the contents of <code>/render-code.js</code> runs the highlighter after all the DOM content is present
            and correct:
          </p>
          <pre><code class="language-Javascript">document.addEventListener("DOMContentLoaded", (event) =&gt; {
  hljs.highlightAll();
});
</code></pre>
          <p>
            The highlight colour theme was chosen to be close to my colour theme, but although close the background
            isn’t a perfect match. I fix this with some CSS in <code>/main.css</code> (using <a href=
            "https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_cascading_variables/Using_CSS_custom_properties">CSS
            custom properties</a> to access bulma’s derived colours), and also style with a fine border:
          </p>
          <pre><code class="language-CSS">/* Fix up the style of the code blocks e.g. consistent background colour. */
code.hljs {
    border: 1px solid grey;
    border-radius: 0px;
    background: var(--bulma-primary-95);
}
</code></pre>
          <p>
            Of course, the above demonstrates the end-result of formatting some HTML and Javascript code.
          </p>
          <h1>
            Navigation breadcrumb
          </h1>
          <p>
            The navigation breadcrumb works by sub-templating, calling <code>{{ super() }}</code> to retain the
            navigation from above. So the pattern is as follows (ignoring all styling).
          </p>
          <pre><code class="language-HTML">&lt;!-- This is the base template: /_page.html --&gt;
&lt;nav class="navigation"&gt;
    {% block breadcrumb %}
    {% endblock breadcrumb %}
&lt;/nav&gt;


&lt;!-- Then in a subclass template in a sub-directory, e.g. /a/_foo.html --&gt;
{% extends "../_page.html" %}

{% block breadcrumb %}
    {{ super() }}
    &lt;a href="/"&gt;Home&lt;/a&gt;
{% endblock breadcrumb%}


&lt;!-- And then again, e.g. in /a/b/_bar.html --&gt;
{% extends "../_foo.html" %}

{% block breadcrumb %}
    {{ super() }}
    &lt;a href="../index.html"&gt;Back to Recreational Maths&lt;/a&gt;
{% endblock breadcrumb%}
</code></pre>
          <h1>
            Manifest and favicons
          </h1>
          <p>
            The <a href="https://www.w3.org/TR/appmanifest/">Web Application Manifest</a> is a <code>JSON</code> file
            containing metadata about a web application. Although this site is not a web app as such, it improves user
            experience to use the manifest to document the location of all the favicons and theme colours.
          </p>
          <p>
            Favicons appear as the icons in browser url bars, tabs, bookmark menus. And also in the “add to home
            screen” feature of touch screen devices.
          </p>
          <p>
            So we need to:
          </p>
          <ul>
            <li>Create a set of favicons, and ensure the colours are coordinated with the colour theme of the website.
            </li>
            <li>Tell browsers where to find all the favicons, noting that some are expected in “standard” locations
            anyway.
            </li>
          </ul>
          <p>
            I created a set of favicons using an online <a href="https://favicon.io/favicon-generator/">favicon
            generator</a>, using the same primary colours as configured in Bulma. These are all copied into the root
            (<code>/</code>) directory of the site according to the file structure principles described above.
          </p>
          <p>
            The manifest then points to these favicons, and is itself put in the root directory as
            <code>/manifest.json</code> (see <a href=
            "https://github.com/tcorbettclark/tcorbettclark.github.io/blob/master/content/manifest.json">here</a>).
          </p>
          <p>
            Lastly, the base template (in <code>_base.html</code>) indicates the principal favicons and the location of
            the manifest:
          </p>
          <pre><code class="language-HTML">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"&gt;
    &lt;head&gt;
        ...
        &lt;link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"&gt;
        &lt;link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"&gt;
        &lt;link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"&gt;
        &lt;link rel="icon" type="image/x-icon" href="/favicon.ico" /&gt;
        &lt;link rel="manifest" href="/manifest.json"&gt;
        ...
    &lt;/head&gt;
    ...
&lt;/html&gt;
</code></pre>
          <h1>
            Colour, styling, and light/dark mode
          </h1>
          <p>
            Colours are both technical and personal. I found these useful to get started:
          </p>
          <ul>
            <li>
              <a href="https://www.learnui.design/blog/the-hsb-color-system-practicioners-primer.html">The HSB Colour
              System</a>
            </li>
            <li>
              <a href="https://www.learnui.design/blog/color-in-ui-design-a-practical-framework.html">Colour in UI
              Design</a>
            </li>
          </ul>
          <p>
            Then the following helped me experiment with different palettes:
          </p>
          <ul>
            <li>
              <a href="https://www.canva.com/colors/color-wheel/">Canva colour wheel</a>
            </li>
            <li>
              <a href="https://pixelied.com/colors/color-wheel">Pixelied colour wheel</a>
            </li>
            <li>
              <a href="https://colorhunt.co">ColorHunt</a>
            </li>
            <li>
              <a href="https://coolors.co">Coolors.co</a>
            </li>
          </ul>
          <p>
            One gotcha I encountered was that there are different variants/standards of RGB.
          </p>
          <p>
            <a href="https://bulma.io">Bulma</a> has a “customizer” popup built-in to their own website, which allows
            colours (and other style aspects) to be tried out before exporting as CSS settings. Because it <a href=
            "https://bulma.io/documentation/features/color-palettes/">automatically derives shades</a>, the main task
            is to decide a Primary colour, a Link colour, and colours for Info, Success, Warning, and Danger.
          </p>
          <p>
            Bulma also automatically derives and manages the colour variations between light and dark mode. For that to
            work, one needs to use the “soft” and “bold” colour classes for those elements which should be a function
            of light/dark mode. For example, I use the <code>has-background-primary-bold-invert</code> and
            <code>has-text-primary-bold</code> classes for the main page section. See the <a href=
            "https://bulma.io/documentation/features/dark-mode/">Bulma docs</a> for details.
          </p>
          <p>
            Lastly, remember to coordinate the colour choices across the Bulma setting, the manifest, and the favicons.
          </p>
          <h1>
            Draft / wip mode
          </h1>
          <p>
            Given the purpose of this website, many files are constantly being revised and refactored. New content
            could be excluded from the build until completely ready, but a “softer and more organic” approach is to
            include it with a DRAFT watermark and delay linking to such pages or adding them to the sitemap until more
            ready. Then such content can be viewed if you know it is there but is not readily discovered otherwise; and
            if seen then it is obvious that it is work-in-progress.
          </p>
          <p>
            To control this watermark, the <code>/_page.html</code> template adds a CSS class if a <code>draft</code>
            variable is set:
          </p>
          <pre><code class="language-html">&lt;div class="content {% if draft %}draft-watermark{% endif %}"&gt;
  {% block page %}{% endblock page %}
&lt;/div&gt;
</code></pre>
          <p>
            The corresponding CSS is:
          </p>
          <pre><code class="language-css">.draft-watermark {
  background-image: url("draft-watermark.svg");
}
</code></pre>
          <p>
            and the corresponding <code>draft-watermark.svg</code> contains
          </p>
          <pre><code class=
          "language-SVG">&lt;svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="170px" width="210px"&gt;
    &lt;text transform="translate(0, 40) rotate(30)" fill="rgba(245,5,5,0.05)" font-size="60px"&gt;
        DRAFT
    &lt;/text&gt;
&lt;/svg&gt;
</code></pre>
          <p>
            Hence to mark a page as in-draft/work-in-progress, set the <code>draft</code> variable at the top of the
            template as follows:
          </p>
          <pre><code class="language-HTML">{% set draft = true %}

{% extends "../_page.html" %}

...etc
</code></pre>
          <h1>
            XML sitemap and the robots.txt file
          </h1>
          <p>
            To support search engine indexing and SEO, the <code>robots.txt</code> file and related sitemap file (in
            <code>sitemap.xml</code>) are used to hint to search engines what pages they should index. See Google’s
            descriptions of <a href=
            "https://developers.google.com/search/docs/crawling-indexing/robots/intro">robots.txt</a> and <a href=
            "https://developers.google.com/search/docs/crawling-indexing/sitemaps/overview">sitemaps</a>.
          </p>
          <p>
            For this site I just use the <code>robots.txt</code> file to point to the sitemap:
          </p>
          <pre><code>Sitemap: {{ SITEURL }}/sitemap.xml
</code></pre>
          <p>
            (the <code>SITEURL</code> is set in a template data TOML file).
          </p>
          <p>
            The <code>sitemap.xml</code> file will also be run though Jinja by <a href="awg.html">AWG</a> because it
            has an <code>.xml</code> extension. Hence it is a template:
          </p>
          <pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"&gt;
    {%- for p in SITEMAP_FILENAMES %}
    &lt;url&gt;
        &lt;loc&gt;{{ SITEURL }}/{{ p.name }}&lt;/loc&gt;
        &lt;changefreq&gt;{{ p.change_frequency or "monthly" }}&lt;/changefreq&gt;
        {%- if p.last_mod %}
        &lt;lastmod&gt;{{ p.last_mod }}&lt;/lastmod&gt;
        {%- endif %}
    &lt;/url&gt;
    {%- endfor %}
&lt;/urlset&gt;
</code></pre>
          <p>
            (Unlike HTML, XML is not automatically tidied by AWG, hence the few “<code>{%-</code>” <a href=
            "https://jinja.palletsprojects.com/en/stable/templates/#whitespace-control">whitespace control</a>
            indicators to indent the output.)
          </p>
          <p>
            The data describing the set of URLs which should be indexed is kept in <code>_sitemap.toml</code>. For
            example:
          </p>
          <pre><code class="language-toml">[[SITEMAP_FILENAMES]]
name = "index.html"
change_frequency = "monthly"

[[SITEMAP_FILENAMES]]
name = "welcome/index.html"
change_frequency = "weekly"
</code></pre>
          <p>
            This isn’t too cumbersomb to maintain (e.g. by listing all candidates with <code>ls -1 **.html</code>). It
            is also possible to put the different entries in different <code>.toml</code> files in respective
            directories.
          </p>
          <h1>
            Validation
          </h1>
          <p>
            Iterating with various (free) validation sites makes it easy to check for correctness, best practice, and
            learn about the web world. For example:
          </p>
          <ul>
            <li>
              <a href="https://developer.chrome.com/docs/lighthouse/overview">Lighthouse</a>
            </li>
            <li>
              <a href="https://validator.w3.org/nu/">W3 Validator</a>
            </li>
            <li>
              <a href="https://developer.mozilla.org/en-US/observatory">MDN’s Observatory tool</a>
            </li>
            <li>
              <a href="https://www.validbot.com/">ValidBot</a>
            </li>
          </ul>
          <p>
            Notable issues I could not address include:
          </p>
          <ol>
            <li>The existence of trailing slashes on void elements such as <code>meta</code> and <code>link</code>
            tags. These cannot be fixed by hand because <a href="awg.html">AWG</a> checks and formats all HTML with
            <a href="https://html-tidy.org">HTML Tidy</a>, produces such trailing slashes. The main concern (see
            <a href="https://wet-boew.github.io/wet-boew-documentation/decision/15.html">here</a> and <a href=
            "https://github.com/validator/validator/wiki/Markup-%C2%BB-Void-elements#trailing-slashes">here</a>) seems
            to be that because HTML5 is not XML, and since href arguments don’t have to be quoted, there is an
            ambiguity if the href is the last attribute and the url contains a trailing slash. Compare:
              <pre><code>&lt;link href=https://foo.bar.baz/&gt;
&lt;link href="https://foo.bar.baz"/&gt;
&lt;link href="https://foo.bar.baz/"&gt;
</code></pre>This isn’t a problem so long as we always quote href’s.
            </li>
            <li>…
            </li>
          </ol>
          <h1>
            Security
          </h1>
          <p>
            Excellent references on web security can be found on <a href="https://web.dev/explore/secure">Google’s
            web.dev</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/Security">Mozzila’s MDN</a>.
          </p>
          <p>
            To find security weaknesses and information about how to address them, I follow the findings from MDN’s
            <a href="https://developer.mozilla.org/en-US/observatory">Observatory tool</a>.
          </p>
          <h2>
            Content Security Policy (CSP)
          </h2>
          <p>
            A <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP">Content Security Policy (CSP)</a>
            instructs browsers to place restrictions on what loaded code can do. This is to defend against
            cross-site-scripting (CSS) and clickjacking in which an attacker finds ways to inject malicious code.
          </p>
          <p>
            A related concept is <a href=
            "https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">SubResource Integrity
            (SRI)</a>, which makes browsers only accept resources when they match the hash contained in the
            <code>integrity</code> attribute. This attribute is notably available on <code>&lt;script&gt;</code> and
            <code>&lt;link rel="stylesheet"&gt;</code> tags. So SRI helps to prevent security problems from source file
            tampering.
          </p>
          <p>
            CSP is configured using the <code>Content-Security-Policy</code> HTTP Header. Since this is a static site I
            use the <code>http-equiv</code> meta tag in every HTML file:
          </p>
          <pre><code class=
          "language-HTML">&lt;meta http-equiv="...name of HTTP Header..." content="...HTTP header contents..."&gt;
</code></pre>
          <p>
            My approach is:
          </p>
          <ul>
            <li>To deny everything by default and add specific permissions as needed.
            </li>
            <li>To always use SRI, including for local (or <code>'self'</code>) files. Note that <a href=
            "awg.html">AWG</a> provides a Jinja filter to make it easy to generate the hashes (such as sha384) from the
            source files.
            </li>
            <li>To check validity using tools such as <a href="https://csp-evaluator.withgoogle.com">CSP Evaluator</a>.
            </li>
          </ul>
          <p>
            In annotated outline, the CSP is as follows:
          </p>
          <pre><code class=
          "language-text">upgrade-insecure-requests;                   &lt;-- Instruct browser to switch site HTTP urls to HTTPS
default-src 'none';                          &lt;-- Default fallback is deny
require-trusted-types-for 'script';          &lt;-- See link below
base-uri 'self';                             &lt;-- Don't allow the base URL to change from self
img-src 'self';                              &lt;-- Only allow images served up from self
manifest-src 'self';                         &lt;-- Only allow manifest served up from self
script-src-elem
    'strict-dynamic'                         &lt;-- Trusted scripts (i.e. javascript) are trusted to use other scripts
    'sha384-kri+HXDJ8qm2+...'                &lt;-- Trust scripts with the following hashes
    ...etc
    ;
connect-src
    'self'                                   &lt;-- Allow connections to self e.g. for websockets (used by hot reloader)
    https://ka-f.fontawesome.com             &lt;-- Allow Fontawesome to make connections
    ;
font-src
    https://cdn.jsdelivr.net                 &lt;-- Allow fonts (e.g. for Katex) from jsDelivr CDN
    https://ka-f.fontawesome.com             &lt;-- Allow Fontawesome fonts
    ;
style-src
    'self'                                   &lt;-- Allow loading of CSS files from self
    https://cdn.jsdelivr.net                 &lt;-- Allow CSS files from jsDelivr CDN
    'sha384-vpayKGwduWhgY...'                &lt;-- Permit CSS with following hashes (does not seem to do anything!)
    ...etc
    ;
</code></pre>
          <p>
            (Link for <a href=
            "https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Content-Security-Policy/require-trusted-types-for">
            require-trusted-types-for</a>.)
          </p>
          <p>
            I discovered a few helpful things along the way:
          </p>
          <ul>
            <li>Safari does not read <code>style-src-elem</code>, but allows it to exist. Chrome does read it. Hence
            using <code>style-src</code>.
            </li>
            <li>The fallback from say <code>style-src-elem</code> to <code>style-src</code> to <code>default-src</code>
            does not mean keep trying until one passes, but use the most specific provided. If the most specific fails
            then the permission is denied.
            </li>
            <li>The <code>style-src</code> section does not do anything with hashes for link files. It neither checks
            the hashes or complains if present. This could be about CSP level 2 vs level 3. See also, <a href=
            "https://stackoverflow.com/questions/77338818/content-security-policy-hashes-for-files-dont-seem-to-work">
              here</a>. I’ve kept the hashes in because I believe it should work like this, and doing so appears
              harmless.
            </li>
            <li>If script hashes are provided in <code>script-src</code> then SRI must also be used (i.e. the
            <code>integrity</code> attribute should exist and contain the hash).
            </li>
            <li>For both CSS and javascript, if the SRI is present (using the <code>integrity</code> attribute), then
            it is checked and must pass. Hence independently of CSP, SRI seems uniformly implemented.
            </li>
            <li>Test on different browsers, because (a) they may behave differently, and (b) when things don’t work
            they give different diagnostic information (some more helpful than others).
            </li>
          </ul>
          <p>
            In practice, using template data reduces maintenance overhead and helps document what is going on and where
            things are from. For example:
          </p>
          <pre><code class="language-HTML">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"&gt;
    &lt;head&gt;
        ...
        &lt;meta http-equiv="Content-Security-Policy" content="
            ...
            script-src-elem
                'strict-dynamic'
                '{{ KATEX_JS_SHA }}'
                '{{ FONTAWESOME_JS_SHA }}'
                '{{ HIGHLIGHT_JS_SHA }}'
                'sha384-{{ '/hot-reloader.js' | sha() }}'
                'sha384-{{ '/render-maths.js' | sha() }}'
                'sha384-{{ '/render-code.js' | sha() }}'
                ;
            ...
            style-src
                'self'
                https://cdn.jsdelivr.net
                {%- for sha in FONTAWESOME_INLINE_CSS_SHAs %}
                '{{ sha }}'
                {%- endfor %}
                '{{ BULMA_CSS_SHA }}'
                '{{ KATEX_CSS_SHA }}'
                '{{ GRUVBOX_CSS_SHA }}'
                'sha384-{{ '/main.css' | sha() }}'
                ;
        "&gt;
        ...

        &lt;link rel="stylesheet" type="text/css" href="{{ KATEX_CSS }}" integrity="{{ KATEX_CSS_SHA }}" crossorigin="anonymous"&gt;
        ...
        &lt;script defer src="{{ KATEX_JS }}" integrity="{{ KATEX_JS_SHA }}" crossorigin="anonymous"&gt;&lt;/script&gt;
        ...
        &lt;script defer src="/hot-reloader.js" integrity="sha384-{{ '/hot-reloader.js' | sha() }}" async&gt;&lt;/script&gt;
        ...
    &lt;/head&gt;
    ...
&lt;/html&gt;
</code></pre>
          <p>
            Note:
          </p>
          <ul>
            <li>The <code>crossorigin="anonymous"</code> attribute on the <code>&lt;link&gt;</code> and
            <code>&lt;script&gt;</code> tags is needed to make the browser send the appropriate CORS headers to fetch
            external resources without leaking user credentials - see <a href=
            "https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Attributes/crossorigin">here</a>.
            </li>
            <li>The <code>sha()</code> Jinja filter provided by AWG is used to statically compute hashes of local
            content. It is done in two places for each file: the CSP header and the SRI integrity attribute.
            </li>
            <li>Jinja variables help show meaning and aid re-use. They are kept in a TOML file, e.g. as follows:
            </li>
          </ul>
          <pre><code class="language-TOML"># Maths
KATEX_CSS = "https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"
KATEX_CSS_SHA = "sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP"
KATEX_JS = "https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"
KATEX_JS_SHA = "sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6"

# Theme for highlight.js
HIGHLIGHT_JS = "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"
HIGHLIGHT_JS_SHA = "sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp"
GRUVBOX_CSS = "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/base16/gruvbox-light-hard.min.css"
GRUVBOX_CSS_SHA = "sha384-vpayKGwduWhgY00faoPtbmJwz8TjOLnnDuqvy+xWy2DWuIVxIt0dxj0mjrMVPxdd"

# Framework
BULMA_CSS = "https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css"
BULMA_CSS_SHA = "sha384-tl5h4XuWmVzPeVWU0x8bx0j/5iMwCBduLEgZ+2lH4Wjda+4+q3mpCww74dgAB3OX"

# Fonts
FONTAWESOME_JS = "https://kit.fontawesome.com/39e34b83e1.js"
FONTAWESOME_JS_SHA = "sha384-yTB2wx6UBfG/vVmw00WOL5kU63/nWDZTw1KXg6BapzYP+xoYMMDemsecEoIJEK5h"
FONTAWESOME_INLINE_CSS_SHAs = [ # Fontawesome subsequently uses inline resources.
    "sha256-E2q5uhm+T8+yRPO91kGFCPrb999m9YzwEB9sWmKzTwk=",
    "sha256-xyO8S5xWOAtczCCfbCiMJgKOLsrQ0neV9mX7Aan06aw=",
    "sha256-bi2K0pOjkFvwpWy9QI9qM3EUJiA+VcVJ5GGZIwSEFhQ=",
    "sha256-0Y0YoXQ0nmYkphSjq+iyr2TWsiF2CUw7gsn8mpwIUog=",
]
</code></pre>
          <h2>
            Strict Transport Security (HSTS)
          </h2>
          <p>
            This site can use HTTPS throughout. To help prevent manipulator-in-the-middle (MiTM) attacks, the <a href=
            "https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Strict-Transport-Security">Strict-Transport-Security</a>
            HTTP Header should be set, together with the <a href=
            "https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Content-Security-Policy/upgrade-insecure-requests">
            upgrade-insecure-requests</a> directive in the CSP.
          </p>
          <p>
            Hence the following are added in the <code>_base.html</code> template to the <code>&lt;head&gt;</code> tag.
          </p>
          <pre><code class="language-html">&lt;meta http-equiv="Upgrade-Insecure-Requests" content="1" /&gt;
&lt;meta
  http-equiv="Strict-Transport-Security"
  content="max-age=63072000; includeSubDomains"
/&gt;
</code></pre>
          <p>
            (<code>max-age</code> is set to the recommended 2 years).
          </p>
          <p>
            The <code>upgrade-insecure-requests</code> CSP directive is explained in the Content Security Section
            above.
          </p>
          <p>
            I’ve also configured GitHub Pages to only serve HTTPS.
          </p>
          <p>
            <strong>NB:</strong> The presence of these security settings means that AWG must be run in HTTPS mode.
          </p>
          <h2>
            Deny embedding
          </h2>
          <p>
            A clickjacking approach relies on embedding sites in other sites. Ideally this would be prevented using CSP
            by setting the <code>frame-ancestors</code> and the <code>X-Frame-Options</code> header. See <a href=
            "https://developer.mozilla.org/en-US/docs/Web/Security/Practical_implementation_guides/Clickjacking">here</a>
            for details. But unfortunately neither can be done using <code>http-equiv</code> and I don’t have control
            over the server HTTP Headers.
          </p>
          <h2>
            Referrer policy
          </h2>
          <p>
            To stop leaking information about where outbound links are coming from (see <a href=
            "https://developer.mozilla.org/en-US/docs/Web/Security/Practical_implementation_guides/Referrer_policy">here</a>),
            I set the HTTP header as follows:
          </p>
          <pre><code class="language-HTML">...
&lt;meta http-equiv="Referrer-Policy" content="no-referrer"&gt;
...
</code></pre>
          <h2>
            MIME types
          </h2>
          <p>
            To inform browsers not to load scripts and stylesheets unless the server indicates the correct MIME type, I
            set the <code>X-Content-Type-Options</code> header using the <code>&lt;meta&gt;</code> tag to
            <code>nosniff</code> as explained <a href=
            "https://developer.mozilla.org/en-US/docs/Web/Security/Practical_implementation_guides/MIME_types">here</a>:
          </p>
          <pre><code class="language-HTML">...
&lt;meta http-equiv="X-Content-Type-Options" content="nosniff"&gt;
...
</code></pre>
          <h1>
            Deployment on GitHub pages
          </h1>
          <p>
            It is easy and convenient to host static content on <a href="https://pages.github.com">GitHub pages</a>.
          </p>
          <p>
            One can either use files from a git branch, the root directory of the repository, or a directory called
            <code>docs/</code>. It would be nice to be able to use a different directory name, but so be it. I just use
            the <code>docs/</code> directory on the master branch.
          </p>
          <p>
            A custom domain can be used by creating a <code>CNAME</code> file containing the full domain (in my case,
            <code>www.corbettclark.com</code>).
          </p>
          <p>
            The default GitHub action detects code commits and deploys on their infrastructure, making the result
            visible within a couple of minutes (often faster).
          </p>
          <p>
            As I’m the only person making changes, I mostly dispense with creating a branch and making a pull request
            to myself (<a href="https://docs.github.com/en/get-started/using-github/github-flow">GitHub flow</a>), but
            instead just make a number of meaningful commits locally. Then when ready to publish, I git push to GitHub.
            In short, my workflow is:
          </p>
          <ul>
            <li>Start up <a href="awg.html">AWG</a> with <code>./awg.py content/ docs/ --certfile localhost.pem
            --keyfile localhost-key.pem</code>
            </li>
            <li>Repeat until ready to publish:
              <ul>
                <li>Make changes and check in local browser without leaving my editor (because of hot reload).
                </li>
                <li>Commit locally using git.
                </li>
              </ul>
            </li>
            <li>Git push to GitHub.
            </li>
            <li>After a minute or so, check the changes have reached live ok.
            </li>
          </ul>
        </div>
      </div>
    </section>
    <footer class="footer pt-4 pb-4">
      <div class="has-text-centered">
        <p>
          <span class="icon-text"><span class="icon"><i class="fa-regular fa-copyright"></i></span> <span>Timothy
          Corbett-Clark, 2025</span></span>
        </p>
        <p>
          Website <a href="/building-this-website/index.html">source</a>.
        </p>
      </div>
    </footer>
  </body>
</html>
